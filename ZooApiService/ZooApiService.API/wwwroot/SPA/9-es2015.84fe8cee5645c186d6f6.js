(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{A9Qp:function(e,t,i){"use strict";i.r(t),i.d(t,"DeviceModule",(function(){return G}));var c=i("ofXK"),a=i("PCNd"),s=i("tyNb"),r=i("XNiG"),n=i("1G5W"),o=i("Ojd6"),l=i("wFOr"),b=i("3Pt+"),d=i("0IaG"),m=i("fXoL"),h=i("NgpD"),u=i("tk/3");let v=(()=>{class e{constructor(e){this.httpClient=e}getDevices(){return this.httpClient.get(h.a.devices)}getDevice(e){return this.httpClient.get(h.a.devices+e)}getDevicesForAnimal(e){return this.httpClient.get(h.a.devicesForAnimal+e)}createDevice(e){return this.httpClient.post(h.a.devices,e)}updateDevice(e){return this.httpClient.put(h.a.devices,e)}deleteDevice(e){return this.httpClient.delete(h.a.devices+e)}}return e.\u0275fac=function(t){return new(t||e)(m.Zb(u.b))},e.\u0275prov=m.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var p=i("5eHb"),f=i("sYmb"),C=i("bTqV"),g=i("kmnG"),U=i("NFeN"),V=i("qFsG"),y=i("d3UM"),D=i("FKr1");function F(e,t){1&e&&(m.Vb(0,"mat-error"),m.Cc(1),m.ic(2,"translate"),m.ic(3,"translate"),m.Ub()),2&e&&(m.Cb(1),m.Fc(" ",m.jc(2,2,"Title")," ",m.jc(3,4,"is-required")," "))}function I(e,t){if(1&e&&(m.Vb(0,"mat-option",15),m.Cc(1),m.ic(2,"translate"),m.Ub()),2&e){const e=t.$implicit;m.nc("value",e.value),m.Cb(1),m.Ec(" ",m.jc(2,2,e.title)," ")}}function j(e,t){1&e&&(m.Vb(0,"mat-error"),m.Cc(1),m.ic(2,"translate"),m.ic(3,"translate"),m.Ub()),2&e&&(m.Cb(1),m.Fc(" ",m.jc(2,2,"Device-type")," ",m.jc(3,4,"is-required")," "))}let O=(()=>{class e{constructor(e,t,i,c,a,s){this.fb=e,this.deviceService=t,this.data=i,this.matDialogRef=c,this.toastr=a,this.translate=s,this.destroy$=new r.a,this.getButtonState=()=>this.translate.instant(Object(o.f)(null!=this.data.smartDeviceId,"Device")),this.hasCustomError=(e,t)=>Object(o.g)(e,t)}ngOnInit(){this.deviceTypes=Object(o.e)(l.b),this.createForm(),Object(o.b)(this.toastr)}createForm(){this.deviceForm=this.fb.group({name:[this.data.name,b.q.required],deviceType:[this.data.deviceType,b.q.required]})}onSubmit(){this.deviceForm.valid?null==this.data.smartDeviceId?this.create():this.update():this.deviceForm.markAllAsTouched()}create(){this.deviceService.createDevice({name:this.deviceForm.value.name,animalId:this.data.animalId,deviceType:this.deviceForm.value.deviceType}).pipe(Object(n.a)(this.destroy$)).subscribe(e=>{this.toastr.success(this.translate.instant("Created"),this.translate.instant("Success")),this.matDialogRef.close({action:l.a.Create,data:e.createdId})},e=>{this.toastr.error(this.translate.instant("Failed"),this.translate.instant("Error")),console.log(e)})}update(){this.deviceService.updateDevice({smartDeviceId:this.data.smartDeviceId,newName:this.deviceForm.value.name,deviceType:this.deviceForm.value.deviceType}).pipe(Object(n.a)(this.destroy$)).subscribe(()=>{this.toastr.success(this.translate.instant("Updated"),this.translate.instant("Success")),this.matDialogRef.close({action:l.a.Update,data:this.data.smartDeviceId})},e=>{this.toastr.error(this.translate.instant("Failed"),this.translate.instant("Error")),console.log(e)})}resetForm(){this.createForm()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(b.c),m.Pb(v),m.Pb(d.a),m.Pb(d.e),m.Pb(p.b),m.Pb(f.e))},e.\u0275cmp=m.Jb({type:e,selectors:[["app-create-update-device"]],decls:32,vars:14,consts:[[1,"container"],[1,"form-group","float-right"],[1,"text-right"],["mat-icon-button","","matSuffix","","mat-dialog-close",""],[1,"text-center"],["novalidate","",3,"formGroup","ngSubmit"],["appearance","standard"],["matInput","","formControlName","name"],[4,"ngIf"],["formControlName","deviceType"],[3,"value",4,"ngFor","ngForOf"],[1,"row","px-2","mt-4"],[1,"col-md-6"],["mat-raised-button","","type","submit","color","primary",1,"btn-block"],["mat-raised-button","","type","button",1,"btn-block",3,"click"],[3,"value"]],template:function(e,t){1&e&&(m.Vb(0,"div",0),m.Vb(1,"div",1),m.Vb(2,"div",2),m.Vb(3,"button",3),m.Vb(4,"mat-icon"),m.Cc(5,"close"),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Vb(6,"h3",4),m.Cc(7),m.ic(8,"translate"),m.Ub(),m.Qb(9,"hr"),m.Vb(10,"form",5),m.dc("ngSubmit",(function(){return t.onSubmit()})),m.Vb(11,"mat-form-field",6),m.Vb(12,"mat-label"),m.Cc(13),m.ic(14,"translate"),m.Ub(),m.Qb(15,"input",7),m.Bc(16,F,4,6,"mat-error",8),m.Ub(),m.Vb(17,"mat-form-field",6),m.Vb(18,"mat-label"),m.Cc(19),m.ic(20,"translate"),m.Ub(),m.Vb(21,"mat-select",9),m.Bc(22,I,3,4,"mat-option",10),m.Ub(),m.Bc(23,j,4,6,"mat-error",8),m.Ub(),m.Vb(24,"div",11),m.Vb(25,"div",12),m.Vb(26,"button",13),m.Cc(27),m.Ub(),m.Ub(),m.Vb(28,"div",12),m.Vb(29,"button",14),m.dc("click",(function(){return t.resetForm()})),m.Vb(30,"mat-icon"),m.Cc(31,"cached"),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub()),2&e&&(m.Cb(7),m.Dc(m.jc(8,8,"Device")),m.Cb(3),m.nc("formGroup",t.deviceForm),m.Cb(3),m.Dc(m.jc(14,10,"Title")),m.Cb(3),m.nc("ngIf",t.hasCustomError(t.deviceForm,"name")),m.Cb(3),m.Dc(m.jc(20,12,"Device-type")),m.Cb(3),m.nc("ngForOf",t.deviceTypes),m.Cb(1),m.nc("ngIf",t.hasCustomError(t.deviceForm,"deviceType")),m.Cb(4),m.Ec(" ",t.getButtonState()," "))},directives:[C.a,g.g,d.c,U.a,b.r,b.l,b.f,g.c,g.f,V.b,b.b,b.k,b.e,c.l,y.a,c.k,g.b,D.n],pipes:[f.d],styles:[""]}),e})(),S=(()=>{class e{constructor(e){this.httpClient=e}getRecords(e){return this.httpClient.get(h.a.deviceRecords+e)}create(e){return this.httpClient.post(h.a.deviceRecords,e)}}return e.\u0275fac=function(t){return new(t||e)(m.Zb(u.b))},e.\u0275prov=m.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var k=i("2yVh"),$=i("jaxi");function w(e,t){if(1&e&&(m.Vb(0,"mat-option",8),m.Cc(1),m.Ub()),2&e){const e=t.$implicit;m.nc("value",e),m.Cb(1),m.Ec(" ",e," ")}}function N(e,t){if(1&e&&(m.Vb(0,"mat-option",8),m.Cc(1),m.Ub()),2&e){const e=t.$implicit;m.nc("value",e.animalId),m.Cb(1),m.Ec(" ",e.name," ")}}function R(e,t){if(1&e){const e=m.Wb();m.Vb(0,"tr",17),m.Vb(1,"td",5),m.Vb(2,"button",25),m.dc("click",(function(){m.uc(e);const i=t.$implicit;return m.hc().openRecords(i.smartDeviceId)})),m.Cc(3),m.Ub(),m.Ub(),m.Vb(4,"td",19),m.Cc(5),m.ic(6,"translate"),m.Ub(),m.Vb(7,"td",26),m.Vb(8,"button",27),m.dc("click",(function(){m.uc(e);const i=t.$implicit;return m.hc().addOrUpdate(i.smartDeviceId)})),m.Vb(9,"mat-icon"),m.Cc(10,"edit"),m.Ub(),m.Ub(),m.Vb(11,"button",28),m.dc("click",(function(){m.uc(e);const i=t.$implicit;return m.hc().delete(i.smartDeviceId)})),m.Vb(12,"mat-icon"),m.Cc(13,"delete"),m.Ub(),m.Ub(),m.Ub(),m.Ub()}if(2&e){const e=t.$implicit,i=m.hc();m.Cb(2),m.Gb("selected",e.smartDeviceId===i.deviceSelectedId),m.Cb(1),m.Ec(" ",e.name," "),m.Cb(2),m.Ec(" ",m.jc(6,4,e.deviceType)," ")}}function E(e,t){1&e&&(m.Vb(0,"tr"),m.Vb(1,"td"),m.Vb(2,"p"),m.Cc(3),m.ic(4,"translate"),m.Ub(),m.Ub(),m.Ub()),2&e&&(m.Cb(3),m.Dc(m.jc(4,1,"Empty")))}function T(e,t){if(1&e&&(m.Vb(0,"li",32),m.Vb(1,"div",33),m.Vb(2,"div",34),m.Vb(3,"h6"),m.Cc(4),m.Ub(),m.Ub(),m.Vb(5,"div",35),m.Vb(6,"h6"),m.Vb(7,"small"),m.Vb(8,"i"),m.Cc(9),m.ic(10,"date"),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub()),2&e){const e=t.$implicit;m.Cb(4),m.Ec(" ",e.value," "),m.Cb(5),m.Dc(m.kc(10,2,e.date,"medium"))}}function A(e,t){1&e&&(m.Vb(0,"li",32),m.Vb(1,"h6",39),m.Vb(2,"i"),m.Cc(3),m.ic(4,"translate"),m.Ub(),m.Ub(),m.Ub()),2&e&&(m.Cb(3),m.Dc(m.jc(4,1,"Empty")))}function x(e,t){if(1&e){const e=m.Wb();m.Vb(0,"div",5),m.Vb(1,"div",29),m.Vb(2,"h3"),m.Cc(3),m.ic(4,"translate"),m.Ub(),m.Vb(5,"button",30),m.dc("click",(function(){return m.uc(e),m.hc().refreshRecords()})),m.Cc(6," Refresh "),m.Vb(7,"mat-icon"),m.Cc(8,"cached"),m.Ub(),m.Ub(),m.Ub(),m.Qb(9,"hr"),m.Vb(10,"ul",31),m.Vb(11,"li",32),m.Vb(12,"div",33),m.Vb(13,"div",34),m.Vb(14,"h5"),m.Cc(15),m.ic(16,"translate"),m.Ub(),m.Ub(),m.Vb(17,"div",35),m.Vb(18,"h5"),m.Cc(19),m.ic(20,"translate"),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Vb(21,"ul",36),m.Bc(22,T,11,5,"li",37),m.Bc(23,A,5,3,"li",38),m.Ub(),m.Ub()}if(2&e){const e=m.hc();m.Cb(3),m.Dc(m.jc(4,5,"Device-records")),m.Cb(12),m.Ec(" ",m.jc(16,7,"Message")," "),m.Cb(4),m.Ec(" ",m.jc(20,9,"Date")," "),m.Cb(3),m.nc("ngForOf",e.deviceRecords),m.Cb(1),m.nc("ngIf",0===e.deviceRecords.length)}}const P=[{path:"",redirectTo:"device-list",pathMatch:"full"},{path:"device-list",component:(()=>{class e{constructor(e,t,i,c,a,s,n){this.fb=e,this.deviceService=t,this.deviceRecordService=i,this.animalService=c,this.toastr=a,this.dialog=s,this.translate=n,this.typeNames=[],this.animals=[],this.animalsFiltered=[],this.devices=[],this.deviceRecords=null,this.deviceSelectedId=null,this.destroy$=new r.a}ngOnInit(){this.createForm(),this.getAnimals(),Object(o.b)(this.toastr)}createForm(){this.filterForm=this.fb.group({typeName:"*",animalId:null})}getAnimals(){this.animalService.getAnimals().pipe(Object(n.a)(this.destroy$)).subscribe(e=>{this.animals=e.sort((e,t)=>Date.parse(e.dateOfBirth)<Date.parse(t.dateOfBirth)?1:-1),this.animalsFiltered=this.animals,this.typeNames=this.animals.map(e=>e.typeName).filter((e,t,i)=>i.indexOf(e)===t),this.animalsFiltered.length>0&&(this.filterForm.get("animalId").setValue(this.animalsFiltered[0].animalId),this.selectAnimal(this.animalsFiltered[0].animalId))})}getDevices(){this.deviceService.getDevices().pipe(Object(n.a)(this.destroy$)).subscribe(e=>this.devices=e)}selectedAnimalType(e){"*"===this.filterForm.value.typeName?this.animalsFiltered=this.animals:(this.filterForm.get("animalId").setValue(null),this.devices=[],this.resetSelectedDevice(),this.animalsFiltered=this.animals.filter(e=>e.typeName===this.filterForm.value.typeName))}selectAnimal(e){this.resetSelectedDevice(),this.getDevicesForAnimal()}openRecords(e){this.deviceRecordService.getRecords(e).pipe(Object(n.a)(this.destroy$)).subscribe(t=>{this.deviceRecords=t,this.deviceSelectedId=e},e=>console.log(e))}get canCreate(){return null!=this.filterForm.value.animalId}get canOpenRecords(){return null!=this.deviceSelectedId}addOrUpdate(e){const t=this.findOrDefaultDevice(e);this.dialog.open(O,{width:"28%",autoFocus:!0,data:t}).afterClosed().pipe(Object(n.a)(this.destroy$)).subscribe(e=>{e&&this.refreshData(e)})}delete(e){Object(o.d)(this.devices.find(t=>t.smartDeviceId===e).name,this.translate)&&this.deviceService.deleteDevice(e).pipe(Object(n.a)(this.destroy$)).subscribe(()=>{Object(o.i)(l.a.Delete,this.devices,null,t=>t.smartDeviceId===e),this.toastr.success(this.translate.instant("Deleted"),this.translate.instant("Success"))},e=>{this.toastr.error(this.translate.instant("Failed"),this.translate.instant("Error")),console.log(e)})}refreshRecords(){this.openRecords(this.deviceSelectedId)}findOrDefaultDevice(e){return e?this.devices.find(t=>t.smartDeviceId===e):{smartDeviceId:null,animalId:this.filterForm.value.animalId,name:null,deviceType:null}}resetForm(){this.createForm(),this.animalsFiltered=this.animals,this.devices=[],this.resetSelectedDevice()}getDevicesForAnimal(){this.deviceService.getDevicesForAnimal(this.filterForm.value.animalId).pipe(Object(n.a)(this.destroy$)).subscribe(e=>this.devices=e.sort((e,t)=>e.name>t.name?1:-1),e=>console.log(e))}refreshData(e){const t=e.data,i=e.action;this.deviceService.getDevice(t).pipe(Object(n.a)(this.destroy$)).subscribe(e=>{Object(o.i)(i,this.devices,e,e=>e.smartDeviceId===t),this.devices.sort((e,t)=>e.name>t.name?1:-1)})}resetSelectedDevice(){this.deviceRecords=null,this.deviceSelectedId=null}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(b.c),m.Pb(v),m.Pb(S),m.Pb(k.a),m.Pb(p.b),m.Pb(d.b),m.Pb(f.e))},e.\u0275cmp=m.Jb({type:e,selectors:[["app-smart-device-list"]],decls:51,vars:29,consts:[[1,"row"],[1,"col-md-7"],[1,"text-center","my-2"],["novalidate","",3,"formGroup"],[1,"row","ml-1"],[1,"col-md-5"],["appearance","standard"],["formControlName","typeName",3,"selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","animalId",3,"selectionChange"],[1,"col-md-2"],[1,"my-auto"],[3,"click"],[1,"table-responsive","px-2","mt-3"],[1,"table","table-bordered","text-center"],[1,"thead-light"],[1,"d-flex"],["scope","col",1,"col-md-5"],["scope","col",1,"col-md-3"],["scope","col",1,"col-md-4"],["mat-raised-button","","color","primary",1,"btn","btn-sm",3,"disabled","click"],["class","d-flex",4,"ngFor","ngForOf"],[4,"ngIf"],["class","col-md-5",4,"ngIf"],["type","button",1,"btn","btn-link",3,"click"],[1,"col-md-4"],[1,"btn","btn-sm","btn-warning","mx-1",3,"click"],[1,"btn","btn-sm","btn-danger","mx-1",3,"click"],[1,"d-flex","justify-content-center"],["mat-raised-button","","type","button",1,"btn","btn-sm","ml-3",3,"click"],[1,"list-group","mt-1"],[1,"list-group-item"],[1,"row","px-2"],[1,"col-md-9","my-auto"],[1,"col-md-3","my-auto"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],["class","list-group-item",4,"ngIf"],[1,"px-2"]],template:function(e,t){1&e&&(m.Vb(0,"div",0),m.Vb(1,"div",1),m.Vb(2,"div",2),m.Vb(3,"h3"),m.Cc(4),m.ic(5,"translate"),m.Ub(),m.Ub(),m.Qb(6,"hr"),m.Vb(7,"form",3),m.Vb(8,"div",4),m.Vb(9,"div",5),m.Vb(10,"mat-form-field",6),m.Vb(11,"mat-label"),m.Cc(12),m.ic(13,"translate"),m.Ub(),m.Vb(14,"mat-select",7),m.dc("selectionChange",(function(e){return t.selectedAnimalType(e.value)})),m.Vb(15,"mat-option",8),m.Cc(16),m.ic(17,"translate"),m.Ub(),m.Bc(18,w,2,2,"mat-option",9),m.Ub(),m.Ub(),m.Ub(),m.Vb(19,"div",5),m.Vb(20,"mat-form-field",6),m.Vb(21,"mat-label"),m.Cc(22),m.ic(23,"translate"),m.Ub(),m.Vb(24,"mat-select",10),m.dc("selectionChange",(function(e){return t.selectAnimal(e.value)})),m.Bc(25,N,2,2,"mat-option",9),m.Ub(),m.Ub(),m.Ub(),m.Vb(26,"div",11),m.Vb(27,"mat-button-toggle-group",12),m.Vb(28,"mat-button-toggle",13),m.dc("click",(function(){return t.resetForm()})),m.Vb(29,"mat-icon"),m.Cc(30,"cached"),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Vb(31,"div",14),m.Vb(32,"table",15),m.Vb(33,"thead",16),m.Vb(34,"tr",17),m.Vb(35,"th",18),m.Cc(36),m.ic(37,"translate"),m.Ub(),m.Vb(38,"th",19),m.Cc(39),m.ic(40,"translate"),m.Ub(),m.Vb(41,"th",20),m.Vb(42,"button",21),m.dc("click",(function(){return t.addOrUpdate(null)})),m.Vb(43,"mat-icon"),m.Cc(44,"add"),m.Ub(),m.Cc(45),m.ic(46,"translate"),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Vb(47,"tbody"),m.Bc(48,R,14,6,"tr",22),m.Bc(49,E,5,3,"tr",23),m.Ub(),m.Ub(),m.Ub(),m.Ub(),m.Bc(50,x,24,11,"div",24),m.Ub()),2&e&&(m.Cb(4),m.Dc(m.jc(5,15,"Device-management")),m.Cb(3),m.nc("formGroup",t.filterForm),m.Cb(5),m.Dc(m.jc(13,17,"Animal-type")),m.Cb(3),m.nc("value","*"),m.Cb(1),m.Ec(" ",m.jc(17,19,"All")," "),m.Cb(2),m.nc("ngForOf",t.typeNames),m.Cb(4),m.Dc(m.jc(23,21,"Animal")),m.Cb(3),m.nc("ngForOf",t.animalsFiltered),m.Cb(11),m.Ec(" ",m.jc(37,23,"Title")," "),m.Cb(3),m.Ec(" ",m.jc(40,25,"Device-type")," "),m.Cb(3),m.nc("disabled",!t.canCreate),m.Cb(3),m.Ec(" ",m.jc(46,27,"Create-device")," "),m.Cb(3),m.nc("ngForOf",t.devices),m.Cb(1),m.nc("ngIf",0===t.devices.length),m.Cb(1),m.nc("ngIf",t.canOpenRecords))},directives:[b.r,b.l,b.f,g.c,g.f,y.a,b.k,b.e,D.n,c.k,$.b,$.a,U.a,C.a,c.l],pipes:[f.d,c.e],styles:[".selected[_ngcontent-%COMP%]{color:#8a2be2!important}"]}),e})()}];let B=(()=>{class e{}return e.\u0275mod=m.Nb({type:e}),e.\u0275inj=m.Mb({factory:function(t){return new(t||e)},imports:[[s.e.forChild(P)],s.e]}),e})(),G=(()=>{class e{}return e.\u0275mod=m.Nb({type:e}),e.\u0275inj=m.Mb({factory:function(t){return new(t||e)},imports:[[c.c,B,a.a]]}),e})()}}]);